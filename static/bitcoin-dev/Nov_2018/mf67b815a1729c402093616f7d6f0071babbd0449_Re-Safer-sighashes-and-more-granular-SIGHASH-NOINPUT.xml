<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Re: Safer sighashes and more granular SIGHASH_NOINPUT</title>
  <updated>2025-11-12T03:41:43.897574+00:00</updated>
  <author>
    <name>Pieter Wuille 2018-11-19 22:37:00+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Re: Safer sighashes and more granular SIGHASH_NOINPUT</title>
    <updated>2025-11-12T03:41:43.897615+00:00</updated>
    <link href="https://gnusha.org/pi/bitcoindev/20181128140412.GC22873@mcelrath.org/T/#mf67b815a1729c402093616f7d6f0071babbd0449" rel="alternate"/>
    <summary>Pieter's email presents a thoughtful exploration into potential enhancements for future Segregated Witness (SegWit) versions, addressing specific areas he believes were overlooked in BIP143. He proposes the inclusion of additional elements in the sighash calculation to enhance security and flexibility in Bitcoin transactions. Specifically, Pieter suggests committing to the absolute transaction fee and the scriptPubKey within the sighash. The motivation behind committing to the transaction fee is to prevent wallets from misleading hardware (HW) devices or airgapped signers about the fees being paid. Including the scriptPubKey aims to eliminate deceit regarding the type of output being spent. While recognizing that these additions might not always be desirable, Pieter recommends making them optional to accommodate various needs.

Furthermore, Pieter discusses the interaction with SIGHASH_NOINPUT, an aspect under consideration that allows rebinding signatures to different inputs without needing to know the transaction id (txid) or the exact scriptPubKey/redeemScript ahead of time. This mechanism, while facilitating certain use cases, raises questions about the necessity and security of allowing both prevout changes and arbitrary scriptPubKey modifications. To address potential concerns and provide clearer guidelines on what aspects of a script can be altered, Pieter proposes three new sighash flags: SIGHASH_NOINPUT, SIGHASH_NOFEE, and SIGHASH_SCRIPTMASK, alongside a new opcode, OP_MASK. This opcode would act as a NOP during execution but would signal which parts of the scriptCode can be changed when SIGHASH_SCRIPTMASK is used.

The computation of the sighash, as outlined by Pieter, would largely follow the model established in BIP143 but with modifications based on the presence of these new flags. For example, if SIGHASH_SCRIPTMASK is set, any opcode/push following an OP_MASK in the scriptCode would be excluded from the sighash calculation. Additionally, the inclusion of the scriptPubKey and the transaction fee in the sighash would be conditional on the absence of SIGHASH_SCRIPTMASK and SIGHASH_NOFEE, respectively. Significantly, setting SIGHASH_NOINPUT would nullify hashPrevouts, hashSequence, and outpoint, mirroring BIP118 but with distinctions in the treatment of scriptCode.

In his concluding remarks, Pieter invites feedback on the proposal, seeking insights into whether the suggested changes introduce unnecessary complexity or fail to cover important use cases. This invitation underscores the collaborative nature of Bitcoin protocol development and Pieter's commitment to refining the security and functionality of Bitcoin transactions.</summary>
    <published>2018-11-19T22:37:00+00:00</published>
  </entry>
</feed>
